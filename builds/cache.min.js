/*
 * Cache-js
 *
 * The MIT License
 */"use strict";(function(){function i(a){var b=a.length,c=0;while(b--)c+=(c<<5)+a.charCodeAt(b);return Math.abs(c).toString(32)}function j(a,b){var c={},d=g(b),e=d.length,f;while(e--)f=d[e],c[f]=a&&a[f]?a[f]:b[f];return c}function k(a){return"string"==typeof a||"object"==typeof a&&"[object String]"===e.call(a)}function l(a){return"object"==typeof a&&"[object Object]"===e.call(a)}function m(a){return localStorage.getItem(a)}function n(a,b){return localStorage.setItem(a,b)}function o(a){return localStorage.removeItem(a)}function p(a){this.opt=a,this.cache=[]}function q(a){this.opt=a}function r(a){var b,c=a.storage;if(l(c))b=c;else if(k(c))switch(c){case"local":b=new q(a);break;case"app":default:b=new p(a)}return b}function s(){function l(a,b){var c=!1,d=e[a];return d||(d=[],e[a]=d,c=!0),d.push(b),c}function m(a,b){var c=e[a],d;if(c){d=c.length;while(d--)c[d].apply(null,b)}e[a]=null}function n(){function g(){function b(b){m(f,a)}var a=d.call(arguments);k.set(f,a,b)}function h(b,d){b||!d?c.apply(null,a):m(f,d)}var a=d.call(arguments),e=a.pop(),f=i(b(a));l(f,e)&&(a.push(g),k.get(f,h))}var a=d.call(arguments),c=a.pop(),e={},g,k;return n.__proto__=c,n.clearCache=function(a){k.clear(a||f)},c?(g=j(a.pop(),h),g.cacheKey=g.cacheKey||i(b(g)+c.toString()),k=r(g),n):null}var a=window,b=JSON.stringify,c=JSON.parse,d=Array.prototype.slice,e=Object.prototype.toString,f=function(){},g=Object.keys,h={cacheKey:"",storage:"app",expire:31536e6,max:10};p.prototype._delExpire=function(a){var b=!1,c=this.cache,d=c.length,e=Date.now(),f;while(d--){f=c[d];if(e>f.expire||a===f.key)c.splice(d,1),b=!0}return b},p.prototype.get=function(a,b){var c,d=Date.now(),e=this.cache,f=e.length,g;while(f--){g=e[f];if(g.key===a){c=g;break}}c&&d>c.expire&&(e.splice(f,1),c=null),b(null,c?c.val:null)},p.prototype.set=function(a,b,c){var d=this.cache,e=this.opt.max,f={key:a,expire:Date.now()+this.opt.expire,val:b},g=d.length;g<e?d.push(f):g>=e&&this._delExpire(a)?d.push(f):g>=e&&(d.shift(),d.push(f)),c(null)},p.prototype.clear=function(a){this.cache=[],a(null)},q.prototype._key=function(a){return this.opt.cacheKey+":"+(a||"")},q.prototype._lock=function(a){function d(){var e=Date.now(),f=parseInt(m(c),10)>e;f?setTimeout(d,0):(n(c,e+b),a(null))}var b=1e4,c=this._key("lock");d()},q.prototype._unlock=function(a){o(this._key("lock")),a(null)},q.prototype._getCache=function(a){function e(b){var e;b?a(b):(e=c(m(d)),a(null,e))}var b=this,d=b._key("");b._lock(e)},q.prototype._setCache=function(a,c){var d=this._key(""),e;try{n(d,b(a))}catch(f){e=f}finally{this._unlock(c)}},q.prototype.get=function(a,b){function d(a,d){c._unlock(function(){b(a,d)})}function e(b){var e,f,g=b.length;while(g--){e=b[g];if(e&&e.key===a){f=e;break}}f&&Date.now()>f.expire?(b.splice(g,1),f=null,c._setCache(b,d)):d(null,f?f.val:null)}function f(a,b){a||!b?d(a,null):e(b)}var c=this;c._getCache(f)},q.prototype.set=function(a,b,c){function e(e){var f=d.opt.max,g=e.length,h,i;if(g<f)e.push({key:a,expire:Date.now()+d.opt.expire,val:b});else if(g>=f){while(g--){i=e[g];if(i&&i.key===a){h=i;break}}h?(h.expire=Date.now()+d.opt.expire,h.val=b):(e.shift(),e.push({key:a,expire:Date.now()+d.opt.expire,val:b}))}d._setCache(e,c)}function f(a,b){a?c(a):e(b||[])}var d=this;d._getCache(f)},q.prototype.clear=function(a){function c(c){o(b._key()),b._unlock(a)}var b=this;b._lock(c)},a.cache=s})();